<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥–∞–¥–∫–∏ –º–∏—Ä–∞ - –û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .start-screen, .game-screen {
            display: none;
        }

        .start-screen.active, .game-screen.active {
            display: block;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #5a6268;
        }

        .room-info {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .room-link {
            background: white;
            padding: 15px;
            border-radius: 5px;
            word-break: break-all;
            margin: 10px 0;
            font-family: monospace;
            border: 2px dashed #667eea;
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .copy-btn {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            border: none;
            font-size: 1em;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .players {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .player-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
        }

        .player-card.you {
            border-color: #667eea;
        }

        .player-name {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .player-score {
            font-size: 2em;
            color: #764ba2;
            font-weight: bold;
        }

        .player-status {
            font-size: 0.9em;
            color: #666;
            margin-top: 8px;
            font-style: italic;
        }

        .riddle-card {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            min-height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.3em;
            line-height: 1.6;
            position: relative;
        }

        .riddle-number {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
        }

        .answer-section {
            margin: 20px 0;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .answer-input:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .help-section {
            background: #fff3cd;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .help-section.active {
            display: block;
        }

        .help-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .help-option {
            padding: 15px;
            background: white;
            border: 2px solid #ffc107;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }

        .help-option:hover {
            background: #fff8e1;
            transform: scale(1.05);
        }

        .help-option.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .help-option.wrong {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .opponent-status {
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-style: italic;
            font-weight: 500;
        }

        .opponent-answer {
            background: #e3f2fd;
            color: #1976d2;
        }

        .opponent-help {
            background: #fff3e0;
            color: #f57c00;
        }

        .result-message {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            display: none;
        }

        .result-message.active {
            display: block;
        }

        .result-message.correct {
            background: #d4edda;
            color: #155724;
        }

        .result-message.wrong {
            background: #f8d7da;
            color: #721c24;
        }

        .waiting {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            color: #666;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background: #ddd;
        }

        .divider::before {
            left: 0;
        }

        .divider::after {
            right: 0;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .waiting {
            animation: pulse 2s infinite;
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            z-index: 1000;
        }

        .connection-status.online {
            background: #d4edda;
            color: #155724;
        }

        .connection-status.connecting {
            background: #fff3cd;
            color: #856404;
        }

        .connection-status.offline {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="connection-status connecting">‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>

    <div class="container">
        <h1>üåç –ó–∞–≥–∞–¥–∫–∏ –º–∏—Ä–∞ üß©</h1>

        <!-- Start Screen -->
        <div class="start-screen active">
            <div class="input-group">
                <label for="playerName">–¢–≤–æ—ë –∏–º—è:</label>
                <input type="text" id="playerName" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ—ë –∏–º—è" value="">
            </div>
            <button class="btn" onclick="createRoom()">üéÆ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</button>
            
            <div class="divider">–∏–ª–∏</div>
            
            <div class="input-group">
                <label for="roomId">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã –¥—Ä—É–≥–∞:</label>
                <input type="text" id="roomId" placeholder="–í—Å—Ç–∞–≤—å –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">
            </div>
            <button class="btn" onclick="joinRoom()">üö™ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ</button>
        </div>

        <!-- Game Screen -->
        <div class="game-screen">
            <div class="room-info">
                <div id="roomIdDisplay"></div>
                <div id="waitingMessage" class="waiting" style="display: none;">
                    ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...
                </div>
            </div>

            <div class="players">
                <div class="player-card you">
                    <div class="player-name" id="player1Name">–¢—ã</div>
                    <div class="player-score" id="player1Score">0</div>
                    <div class="player-status" id="player1Status"></div>
                </div>
                <div class="player-card">
                    <div class="player-name" id="player2Name">–û–ø–ø–æ–Ω–µ–Ω—Ç</div>
                    <div class="player-score" id="player2Score">0</div>
                    <div class="player-status" id="player2Status"></div>
                </div>
            </div>

            <div id="gameContent" style="display: none;">
                <div class="riddle-card">
                    <span class="riddle-number" id="riddleNumber"></span>
                    <div id="riddleText"></div>
                </div>

                <div id="opponentStatus"></div>

                <div class="answer-section">
                    <input type="text" class="answer-input" id="answerInput" 
                           placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç..." disabled>
                    <button class="btn" id="submitBtn" onclick="submitAnswer()" disabled>
                        ‚úÖ –û—Ç–≤–µ—Ç–∏—Ç—å
                    </button>
                    <button class="btn secondary" id="helpBtn" onclick="showHelp()" 
                            style="background: #ffc107; margin-top: 10px;" disabled>
                        üÜò –ü–æ–º–æ—â—å (–≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤)
                    </button>
                </div>

                <div class="help-section" id="helpSection">
                    <div style="margin-bottom: 10px; font-weight: bold; color: #856404;">
                        üí° –í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:
                    </div>
                    <div class="help-options" id="helpOptions"></div>
                </div>

                <div class="result-message" id="resultMessage"></div>

                <button class="btn" id="nextBtn" onclick="nextRiddle()" 
                        style="display: none;">
                    ‚û°Ô∏è –°–ª–µ–¥—É—é—â–∞—è –∑–∞–≥–∞–¥–∫–∞
                </button>
            </div>
        </div>
    </div>

    <script>
        // Riddles database - –∑–∞–≥–∞–¥–∫–∏ —Å–æ –≤—Å–µ–≥–æ –º–∏—Ä–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
        const riddles = [
            {
                question: "–ß—Ç–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Å –∑–∞–∫—Ä—ã—Ç—ã–º–∏ –≥–ª–∞–∑–∞–º–∏?",
                answer: "—Å–æ–Ω",
                options: ["—Å–æ–Ω", "–Ω–æ—á—å", "—Ç–µ–º–Ω–æ—Ç–∞", "–º–µ—á—Ç–∞"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–ë–µ–∑ —Ä—É–∫, –±–µ–∑ –Ω–æ–≥, –∞ –≤–æ—Ä–æ—Ç–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç.",
                answer: "–≤–µ—Ç–µ—Ä",
                options: ["–≤–µ—Ç–µ—Ä", "–≤–æ–¥–∞", "—Å–æ–ª–Ω—Ü–µ", "–¥–æ–∂–¥—å"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–ó–∏–º–æ–π –∏ –ª–µ—Ç–æ–º –æ–¥–Ω–∏–º —Ü–≤–µ—Ç–æ–º.",
                answer: "—ë–ª–∫–∞",
                options: ["—ë–ª–∫–∞", "—Å–æ—Å–Ω–∞", "—Ç—Ä–∞–≤–∞", "–∫–µ–¥—Ä"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–í–∏—Å–∏—Ç –≥—Ä—É—à–∞, –Ω–µ–ª—å–∑—è —Å–∫—É—à–∞—Ç—å.",
                answer: "–ª–∞–º–ø–æ—á–∫–∞",
                options: ["–ª–∞–º–ø–æ—á–∫–∞", "—Ñ–æ–Ω–∞—Ä—å", "–ª—É–Ω–∞", "–∑–≤–µ–∑–¥–∞"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–°—Ç–æ–∏—Ç –ê–Ω—Ç–æ—à–∫–∞ –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–∂–∫–µ.",
                answer: "–≥—Ä–∏–±",
                options: ["–≥—Ä–∏–±", "–¥–µ—Ä–µ–≤–æ", "—Ü–≤–µ—Ç–æ–∫", "—á–µ–ª–æ–≤–µ–∫"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–ß—Ç–æ –∏–¥—ë—Ç, –Ω–µ –¥–≤–∏–≥–∞—è—Å—å —Å –º–µ—Å—Ç–∞?",
                answer: "–≤—Ä–µ–º—è",
                options: ["–≤—Ä–µ–º—è", "–¥–æ—Ä–æ–≥–∞", "—Ä–µ–∫–∞", "—á–∞—Å—ã"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–ù–µ –æ–≥–æ–Ω—å, –∞ –∂–∂—ë—Ç—Å—è.",
                answer: "–∫—Ä–∞–ø–∏–≤–∞",
                options: ["–∫—Ä–∞–ø–∏–≤–∞", "–∫–∏–ø—è—Ç–æ–∫", "–ª—ë–¥", "–º–æ—Ä–æ–∑"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–ß—Ç–æ –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç, –∞ —Å –º–µ—Å—Ç–∞ –Ω–µ —Å–æ–π–¥—ë—Ç?",
                answer: "–¥–æ—Ä–æ–≥–∞",
                options: ["–¥–æ—Ä–æ–≥–∞", "—Ç—Ä–æ–ø–∏–Ω–∫–∞", "–ø—É—Ç—å", "–º–æ—Å—Ç"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–ù–µ –º–æ—Ä–µ, –Ω–µ –∑–µ–º–ª—è, –∫–æ—Ä–∞–±–ª–∏ –Ω–µ –ø–ª–∞–≤–∞—é—Ç, –∏ —Ö–æ–¥–∏—Ç—å –Ω–µ–ª—å–∑—è.",
                answer: "–±–æ–ª–æ—Ç–æ",
                options: ["–±–æ–ª–æ—Ç–æ", "–ø—É—Å—Ç—ã–Ω—è", "—Ç—É–º–∞–Ω", "–ø–µ—Å–æ–∫"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–£ –º–µ–Ω—è –µ—Å—Ç—å –≥–æ—Ä–æ–¥–∞, –Ω–æ –Ω–µ—Ç –¥–æ–º–æ–≤. –ï—Å—Ç—å –≥–æ—Ä—ã, –Ω–æ –Ω–µ—Ç –¥–µ—Ä–µ–≤—å–µ–≤. –ï—Å—Ç—å –≤–æ–¥–∞, –Ω–æ –Ω–µ—Ç —Ä—ã–±. –ß—Ç–æ —è?",
                answer: "–∫–∞—Ä—Ç–∞",
                options: ["–∫–∞—Ä—Ç–∞", "–∫–Ω–∏–≥–∞", "–≥–ª–æ–±—É—Å", "–∫–∞—Ä—Ç–∏–Ω–∞"],
                country: "üá∫üá∏ –°–®–ê"
            },
            {
                question: "–£ –º–µ–Ω—è –µ—Å—Ç—å —Ä—É–∫–∏, –Ω–æ —è –Ω–µ –º–æ–≥—É —Ö–ª–æ–ø–∞—Ç—å. –ß—Ç–æ —è?",
                answer: "—á–∞—Å—ã",
                options: ["—á–∞—Å—ã", "—Å—Ç–∞—Ç—É—è", "–ø–µ—Ä—á–∞—Ç–∫–∏", "—Ä–æ–±–æ—Ç"],
                country: "üá¨üáß –ê–Ω–≥–ª–∏—è"
            },
            {
                question: "–ß–µ–º –±–æ–ª—å—à–µ –±–µ—Ä—ë—à—å, —Ç–µ–º –±–æ–ª—å—à–µ –æ—Å—Ç–∞–≤–ª—è–µ—à—å –ø–æ–∑–∞–¥–∏. –ß—Ç–æ —ç—Ç–æ?",
                answer: "—Å–ª–µ–¥—ã",
                options: ["—Å–ª–µ–¥—ã", "–≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è", "–≤—Ä–µ–º—è", "—Ç–µ–Ω–∏"],
                country: "üá¨üáß –ê–Ω–≥–ª–∏—è"
            },
            {
                question: "–ß—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω–∏–∑?",
                answer: "–≤–æ–∑—Ä–∞—Å—Ç",
                options: ["–≤–æ–∑—Ä–∞—Å—Ç", "—à–∞—Ä–∏–∫", "–¥—ã–º", "—Ä–∞–∫–µ—Ç–∞"],
                country: "üá∫üá∏ –°–®–ê"
            },
            {
                question: "–Ø –ª—ë–≥–∫–∏–π –∫–∞–∫ –ø–µ—Ä–æ, –Ω–æ –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –º–µ–Ω—è –¥–æ–ª–≥–æ. –ß—Ç–æ —è?",
                answer: "–¥—ã—Ö–∞–Ω–∏–µ",
                options: ["–¥—ã—Ö–∞–Ω–∏–µ", "–≤–æ–∑–¥—É—Ö", "–æ–±–ª–∞–∫–æ", "–≤–µ—Ç–µ—Ä"],
                country: "üá´üá∑ –§—Ä–∞–Ω—Ü–∏—è"
            },
            {
                question: "–¢—ã—Å—è—á–∞ –±—Ä–∞—Ç—å–µ–≤ –æ–¥–Ω–∏–º –ø–æ—è—Å–æ–º –ø–æ–¥–ø–æ—è—Å–∞–Ω—ã.",
                answer: "—Å–Ω–æ–ø",
                options: ["—Å–Ω–æ–ø", "–∑–∞–±–æ—Ä", "–≤–µ–Ω–∏–∫", "–±—É–∫–µ—Ç"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–ñ–∏–≤—ë—Ç –±–µ–∑ —Ç–µ–ª–∞, –≥–æ–≤–æ—Ä–∏—Ç –±–µ–∑ —è–∑—ã–∫–∞, –Ω–∏–∫—Ç–æ –µ–≥–æ –Ω–µ –≤–∏–¥–∏—Ç, –∞ –≤—Å—è–∫–∏–π —Å–ª—ã—à–∏—Ç.",
                answer: "—ç—Ö–æ",
                options: ["—ç—Ö–æ", "–≤–µ—Ç–µ—Ä", "—Ä–∞–¥–∏–æ", "–≥–æ–ª–æ—Å"],
                country: "üá∑üá∫ –†–æ—Å—Å–∏—è"
            },
            {
                question: "–£—Ç—Ä–æ–º —Ö–æ–¥–∏—Ç –Ω–∞ —á–µ—Ç—ã—Ä—ë—Ö –Ω–æ–≥–∞—Ö, –¥–Ω—ë–º –Ω–∞ –¥–≤—É—Ö, –≤–µ—á–µ—Ä–æ–º –Ω–∞ —Ç—Ä—ë—Ö. –ß—Ç–æ —ç—Ç–æ?",
                answer: "—á–µ–ª–æ–≤–µ–∫",
                options: ["—á–µ–ª–æ–≤–µ–∫", "–∂–∏–≤–æ—Ç–Ω–æ–µ", "—Å—Ç–æ–ª", "–∫—Ä–µ—Å–ª–æ"],
                country: "üá¨üá∑ –ì—Ä–µ—Ü–∏—è"
            },
            {
                question: "–ö—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö –º–∏—Ä–∞?",
                answer: "—ç—Ö–æ",
                options: ["—ç—Ö–æ", "–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫", "—Ä–∞–¥–∏–æ", "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç"],
                country: "üá®üá≥ –ö–∏—Ç–∞–π"
            },
            {
                question: "–ß—ë—Ä–Ω—ã–π —è—â–∏–∫: —á–µ–º –±–æ–ª—å—à–µ –∏–∑ –Ω–µ–≥–æ –±–µ—Ä—ë—à—å, —Ç–µ–º –±–æ–ª—å—à–µ –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è.",
                answer: "—è–º–∞",
                options: ["—è–º–∞", "–¥—ã—Ä–∞", "–º–µ—à–æ–∫", "–∫–æ–ª–æ–¥–µ—Ü"],
                country: "üáØüáµ –Ø–ø–æ–Ω–∏—è"
            },
            {
                question: "–ß—Ç–æ –º–æ–∂–µ—Ç –ø—É—Ç–µ—à–µ—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ –º–∏—Ä—É, –æ—Å—Ç–∞–≤–∞—è—Å—å –≤ –æ–¥–Ω–æ–º —É–≥–ª—É?",
                answer: "–º–∞—Ä–∫–∞",
                options: ["–º–∞—Ä–∫–∞", "–∫–æ–º–ø–∞—Å", "–∫–∞—Ä—Ç–∞", "–º–æ–Ω–µ—Ç–∞"],
                country: "üá¨üáß –ê–Ω–≥–ª–∏—è"
            }
        ];

        // Game state
        let peer = null;
        let conn = null;
        let gameState = {
            isHost: false,
            myId: null,
            myName: '',
            opponentName: '',
            myScore: 0,
            opponentScore: 0,
            currentRiddle: 0,
            hasUsedHelp: false,
            answered: false,
            opponentAnswered: false,
            opponentUsedHelp: false
        };

        // Initialize PeerJS
        function initPeer() {
            peer = new Peer({
                config: {
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:global.stun.twilio.com:3478' }
                    ]
                }
            });

            peer.on('open', (id) => {
                gameState.myId = id;
                updateConnectionStatus('online');
            });

            peer.on('error', (err) => {
                console.error('PeerJS error:', err);
                updateConnectionStatus('offline');
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            });

            peer.on('connection', (connection) => {
                conn = connection;
                setupConnection();
            });
        }

        function updateConnectionStatus(status) {
            const statusEl = document.querySelector('.connection-status');
            if (status === 'online') {
                statusEl.className = 'connection-status online';
                statusEl.textContent = 'üü¢ –û–Ω–ª–∞–π–Ω';
            } else if (status === 'connecting') {
                statusEl.className = 'connection-status connecting';
                statusEl.textContent = '‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            } else {
                statusEl.className = 'connection-status offline';
                statusEl.textContent = 'üî¥ –ù–µ—Ç —Å–≤—è–∑–∏';
            }
        }

        function createRoom() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏ —Å–≤–æ—ë –∏–º—è!');
                return;
            }

            gameState.isHost = true;
            gameState.myName = name;

            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');

            const roomId = gameState.myId;
            const fullUrl = window.location.href.split('?')[0] + '?room=' + roomId;
            
            document.getElementById('roomIdDisplay').innerHTML = 
                `<strong>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</strong>
                <div class="room-link">${roomId}</div>
                <button class="copy-btn" onclick="copyToClipboard('${fullUrl}')">
                    üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
                <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    –û—Ç–ø—Ä–∞–≤—å –∫–æ–¥ –∏–ª–∏ —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É!
                </div>`;
            
            document.getElementById('player1Name').textContent = name + ' (—Ç—ã)';
            document.getElementById('waitingMessage').style.display = 'block';
        }

        function joinRoom() {
            const name = document.getElementById('playerName').value.trim();
            const roomId = document.getElementById('roomId').value.trim();

            if (!name || !roomId) {
                alert('–í–≤–µ–¥–∏ –∏–º—è –∏ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã!');
                return;
            }

            gameState.isHost = false;
            gameState.myName = name;

            updateConnectionStatus('connecting');

            conn = peer.connect(roomId);
            setupConnection();

            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');

            document.getElementById('roomIdDisplay').innerHTML = 
                `<strong>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</strong><div class="room-link">${roomId}</div>`;
            
            document.getElementById('player1Name').textContent = name + ' (—Ç—ã)';
        }

        function setupConnection() {
            conn.on('open', () => {
                updateConnectionStatus('online');
                
                // Send initial data
                sendData({
                    type: 'join',
                    name: gameState.myName,
                    score: gameState.myScore
                });

                document.getElementById('waitingMessage').style.display = 'none';
                document.getElementById('gameContent').style.display = 'block';
                
                if (gameState.isHost) {
                    loadRiddle(0);
                }
            });

            conn.on('data', (data) => {
                handleData(data);
            });

            conn.on('close', () => {
                updateConnectionStatus('offline');
                alert('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ. –û–ø–ø–æ–Ω–µ–Ω—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è.');
            });

            conn.on('error', (err) => {
                console.error('Connection error:', err);
                updateConnectionStatus('offline');
            });
        }

        function sendData(data) {
            if (conn && conn.open) {
                conn.send(data);
            }
        }

        function handleData(data) {
            switch(data.type) {
                case 'join':
                    gameState.opponentName = data.name;
                    gameState.opponentScore = data.score;
                    document.getElementById('player2Name').textContent = data.name;
                    document.getElementById('player2Score').textContent = data.score;
                    
                    // Send current game state to new player
                    if (gameState.isHost) {
                        sendData({
                            type: 'gameState',
                            riddleIndex: gameState.currentRiddle,
                            myName: gameState.myName,
                            myScore: gameState.myScore
                        });
                    }
                    break;

                case 'gameState':
                    gameState.opponentName = data.myName;
                    gameState.opponentScore = data.myScore;
                    document.getElementById('player2Name').textContent = data.myName;
                    document.getElementById('player2Score').textContent = data.myScore;
                    loadRiddle(data.riddleIndex);
                    break;

                case 'answer':
                    gameState.opponentAnswered = true;
                    updateOpponentStatus();
                    break;

                case 'help':
                    gameState.opponentUsedHelp = true;
                    updateOpponentStatus();
                    break;

                case 'score':
                    gameState.opponentScore = data.score;
                    document.getElementById('player2Score').textContent = data.score;
                    break;

                case 'nextRiddle':
                    gameState.currentRiddle = data.riddleIndex;
                    gameState.opponentAnswered = false;
                    gameState.opponentUsedHelp = false;
                    loadRiddle(data.riddleIndex);
                    break;
            }
        }

        function updateOpponentStatus() {
            const statusDiv = document.getElementById('opponentStatus');
            statusDiv.innerHTML = '';

            if (gameState.opponentAnswered && !gameState.answered) {
                const answerDiv = document.createElement('div');
                answerDiv.className = 'opponent-status opponent-answer';
                answerDiv.textContent = `${gameState.opponentName} —É–∂–µ –æ—Ç–≤–µ—Ç–∏–ª! ‚è±Ô∏è`;
                statusDiv.appendChild(answerDiv);
            }

            if (gameState.opponentUsedHelp && !gameState.hasUsedHelp) {
                const helpDiv = document.createElement('div');
                helpDiv.className = 'opponent-status opponent-help';
                helpDiv.textContent = `${gameState.opponentName} –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø–æ–º–æ—â—å üÜò`;
                statusDiv.appendChild(helpDiv);
            }

            // Update status indicators
            if (gameState.opponentAnswered) {
                document.getElementById('player2Status').textContent = '‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω';
            } else {
                document.getElementById('player2Status').textContent = '';
            }

            if (gameState.answered) {
                document.getElementById('player1Status').textContent = '‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω';
            } else {
                document.getElementById('player1Status').textContent = '';
            }
        }

        function loadRiddle(index) {
            gameState.currentRiddle = index;
            
            if (gameState.currentRiddle >= riddles.length) {
                showFinalResults();
                return;
            }

            const riddle = riddles[gameState.currentRiddle];
            document.getElementById('riddleNumber').textContent = 
                `${gameState.currentRiddle + 1}/${riddles.length} ${riddle.country}`;
            document.getElementById('riddleText').textContent = riddle.question;
            
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').disabled = false;
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('helpBtn').disabled = false;
            document.getElementById('helpSection').classList.remove('active');
            document.getElementById('resultMessage').classList.remove('active');
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('opponentStatus').innerHTML = '';
            document.getElementById('player1Status').textContent = '';
            document.getElementById('player2Status').textContent = '';
            
            gameState.hasUsedHelp = false;
            gameState.answered = false;
            gameState.opponentAnswered = false;
            gameState.opponentUsedHelp = false;

            // Enable enter key
            document.getElementById('answerInput').onkeypress = function(e) {
                if (e.key === 'Enter') {
                    submitAnswer();
                }
            };
        }

        function showHelp() {
            if (gameState.hasUsedHelp) return;

            gameState.hasUsedHelp = true;
            document.getElementById('helpBtn').disabled = true;
            document.getElementById('helpSection').classList.add('active');

            const riddle = riddles[gameState.currentRiddle];
            const helpOptions = document.getElementById('helpOptions');
            helpOptions.innerHTML = '';

            riddle.options.forEach(option => {
                const div = document.createElement('div');
                div.className = 'help-option';
                div.textContent = option;
                div.onclick = () => {
                    document.getElementById('answerInput').value = option.split(' (')[0]; // Remove translations
                };
                helpOptions.appendChild(div);
            });

            sendData({ type: 'help' });
            updateOpponentStatus();
        }

        function submitAnswer() {
            if (gameState.answered) return;

            const answer = document.getElementById('answerInput').value.trim().toLowerCase();
            if (!answer) {
                alert('–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç!');
                return;
            }

            gameState.answered = true;
            document.getElementById('answerInput').disabled = true;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('helpBtn').disabled = true;

            const riddle = riddles[gameState.currentRiddle];
            const isCorrect = answer === riddle.answer.toLowerCase();

            if (isCorrect) {
                gameState.myScore++;
                document.getElementById('player1Score').textContent = gameState.myScore;
                sendData({ type: 'score', score: gameState.myScore });
            }

            // Show result
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.classList.add('active');
            
            if (isCorrect) {
                resultDiv.className = 'result-message active correct';
                resultDiv.textContent = `üéâ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –û—Ç–≤–µ—Ç: ${riddle.answer}`;
            } else {
                resultDiv.className = 'result-message active wrong';
                resultDiv.textContent = `‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${riddle.answer}`;
            }

            // Show help options result if used
            if (gameState.hasUsedHelp) {
                const helpOptions = document.querySelectorAll('.help-option');
                helpOptions.forEach(opt => {
                    const optText = opt.textContent.split(' (')[0].toLowerCase();
                    if (optText === riddle.answer.toLowerCase()) {
                        opt.classList.add('correct');
                    } else {
                        opt.classList.add('wrong');
                    }
                });
            }

            sendData({ type: 'answer' });
            updateOpponentStatus();
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextRiddle() {
            const nextIndex = gameState.currentRiddle + 1;
            
            if (nextIndex >= riddles.length) {
                showFinalResults();
                return;
            }

            sendData({ type: 'nextRiddle', riddleIndex: nextIndex });
            loadRiddle(nextIndex);
        }

        function showFinalResults() {
            let message = '';
            let emoji = '';
            
            if (gameState.myScore > gameState.opponentScore) {
                message = `–¢—ã –ø–æ–±–µ–¥–∏–ª! –°—á—ë—Ç ${gameState.myScore}:${gameState.opponentScore}`;
                emoji = 'üèÜ';
            } else if (gameState.opponentScore > gameState.myScore) {
                message = `–ü–æ–±–µ–¥–∏–ª ${gameState.opponentName}! –°—á—ë—Ç ${gameState.opponentScore}:${gameState.myScore}`;
                emoji = 'üò¢';
            } else {
                message = `–ù–∏—á—å—è! –°—á—ë—Ç ${gameState.myScore}:${gameState.opponentScore}`;
                emoji = 'ü§ù';
            }

            document.getElementById('gameContent').innerHTML = `
                <div class="riddle-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div>
                        <div style="font-size: 4em; margin-bottom: 20px;">${emoji}</div>
                        <h2 style="margin-bottom: 20px;">–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
                        <p style="font-size: 1.5em;">${message}</p>
                    </div>
                </div>
                <button class="btn" onclick="location.reload()">üîÑ –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</button>
            `;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                btn.style.background = '#28a745';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –°–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é: ' + text);
            });
        }

        // Auto-fill room ID from URL
        window.onload = function() {
            initPeer();
            
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            if (roomId) {
                document.getElementById('roomId').value = roomId;
            }
        };
    </script>
</body>
</html>
